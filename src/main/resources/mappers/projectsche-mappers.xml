<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ScheduleMapper">
	<!-- <resultMap type="ScheduleDto" id="resultSchedule"> property에는 vo의 필드명, 
		column에는 db tabel의 컬럼명 두개를 map으로 연결한다 </resultMap> -->
	<resultMap type="map" id="resultSchedule">
		<!-- property에는 vo의 필드명, column에는 db tabel의 컬럼명 두개를 map으로 연결한다 -->
		<id property="bno" column="bno" />
		<result property="pno" column="pno" />
		<result property="pname" column="pname" />
		<result property="bname" column="bname" />
		<result property="btype" column="btype" />
		<result property="sstart" column="sstart" />
		<result property="send" column="send" />
		<result property="splace" column="splace" />
		<result property="smemo" column="smemo" />
		<result property="uno" column="uno" />
		<result property="uname" column="uname" />
		<result property="tstart" column="tstart" />
		<result property="tend" column="tend" />
		<result property="taskmanager" column="taskmanager" />
	</resultMap>

	<!-- boardall 인서트 -->
	<insert id="insertBoardAllSche">
	 <![CDATA[
	 	insert into boardall values (bno_se.nextval, #{pno} ,#{uno},#{bname},#{bopen},'3', 0, sysdate)
		]]>
	</insert>
	
	<!-- shedule 인서트 -->
	<insert id="insertSchedule" flushCache="true" statementType="PREPARED">  
		<![CDATA[
		 insert into task values (bno_se.currval,#{sstart}, #{send}, #{splace}, #{smemo}, #{attendee}) 
		]]>
	</insert>
	
	<!-- 일정 : 내가 등록한 일정 + 초대받은 일정(1, 1) , 내가 등록한 일정(1, 0), 내가 초대받은 일정(0, 1), 
		전체는 where절을 사라지게 -->
	<select id="selectSche" resultMap="resultSchedule">
		select p.pno as pno, p.pname as pname,b.bno as bno, b.bname as bname,
		b.btype as btype,
		sv.sstart as sstart, sv.send as send, sv.splace as splace, sv.smemo as smemo,
		sv.uno as uno, sv.votetype as votetype, u.uname as uname
		from project p
		inner join boardall b on p.pno = b.pno
		inner join (select s.bno, s.sstart, s.send, s.splace, s.smemo, v.uno,
		v.votetype
		from schedule s left outer join vote v on s.bno = v.bno)sv on b.bno =
		sv.bno
		inner join users u on u.uno = sv.uno
		where b.uno = '1' or sv.uno = '0'
		<!-- <if test="paramMap != null"> where b.uno = '1' or sv.uno = '0' </if> -->
		order by b.bno

	</select>

	<!--업무 : 내업무 (5), 요청한 업무(1), 전체 업무 where 절 사라지게 -->
	<select id="selectTaskSche" resultMap="resultSchedule">

		select p.pno as pno, p.pname as pname, b.bno as bno, b.bname as bname,
		b.btype as btype,
		t.tstart as tstart, t.tend as tend, t.taskmanager as taskmanager, u.uname as
		uname
		from project p
		inner join boardall b on p.pno = b.pno
		inner join task t on b.bno = t.bno
		inner join users u on u.uno = t.taskmanager
		<!-- <if test="paramMap != null"> where b.uno = #{buno} or t.taskmanager 
			=#{svuno} </if> -->
		order by b.bno

	</select>




</mapper>
