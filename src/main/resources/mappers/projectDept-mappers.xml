<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ProjcetDept">
	<resultMap type="projectDeptDto" id="resultProejctDept"
		extends="DeptDto">
		<id property="pno" column="pno" />
		<result property="dno" column="dno" />
		<collection property="DeptDto" ofType="DeptDto"
			column="dno" columnPrefix="d_" select="selectListProjectDetpName"></collection>
	</resultMap>

	<!-- 프로젝트 전체 목록 : 소속 부서보관함명 -->
	<select id="selectListProjectDetpName" resultType="arraylist"
		resultMap="resultProjectDept">
		select pjd.pno, LISTAGG(d_d.dname,',') WITHIN GROUP(ORDER BY
		d_d.dname) AS d_dname
		from project_dept pjd, dept d
		where pjd.dno =
		d.dno
		group by pjd.pno
	</select>

	<!-- 프로젝트 생성 : 부서 입력 -->
	<insert id="insertProjectDept" parameterType="java.util.List"
		flushCache="true" statementType="PREPARED">
		insert into project_dept values
		<foreach collection="list" item="item" separator=",">
			(PNO_SE.CURRVAL, #{item.DNO})
		</foreach>
	</insert>
</mapper>
